# Java 模块系统
在模块系统出现之前，Java 应用程序的类路径是一个庞大、扁平的“类池”。JVM 会按顺序搜索 JAR 文件和目录来查找类，这导致了几个著名的“JAR Hell”问题：
*   **类路径冲突**：同一个库的不同版本可能存在于类路径中，哪个被加载是随机的，导致运行时错误。
*   **脆弱的依赖**：你无法明确知道你的代码依赖了哪些库的哪些内部类。库的内部实现一旦变更，就可能破坏你的应用。
*   **巨大的启动开销**：JVM 启动时需要扫描整个类路径，对于大型应用来说非常慢。
*   **封装性不足**：理论上，任何 `public` 类都可以被任何代码访问，即使是库的内部实现类。库开发者无法强制阻止这种访问。
    **模块系统就是为了解决这些问题而生的。** 它的核心思想是：**将代码组织成强内聚、松耦合的模块，并明确定义模块之间的依赖关系和可见性。**
## 模块系统的核心概念
1.  **模块**
    一个模块是一组相关包和资源的集合，由一个**模块描述符**（`module-info.java` 文件）来定义。它比 JAR 文件拥有更强的身份和边界。
2.  **模块描述符 (`module-info.java`)**
    这是模块系统的灵魂。它是一个位于源代码根目录下的 Java 文件，用来声明模块的：
    *   **名称**：模块的唯一标识。
    *   **依赖**：它需要哪些其他模块才能正常工作 (`requires`)。
    *   **导出**：它对外暴露哪些包 (`exports`)。
    *   **反射**：它允许哪些其他模块在运行时通过反射访问其非导出包的成员 (`opens`)。
        **示例 `module-info.java`：**
    ```java
    // 定义一个名为 com.myapp 的模块
    module com.myapp {
        // 声明依赖：我们需要 java.base (默认) 和 java.logging 模块
        requires java.logging;
        // 声明导出：只允许外部访问 com.myapp.api 这个包
        // com.myapp.internal 包将被隐藏
        exports com.myapp.api;
        // 声明开放：允许 hibernate 这样的框架通过反射访问 com.myapp.entity 包
        opens com.myapp.entity to hibernate.core;
    }
    ```
3.  **模块路径**
    这是取代类路径的新概念。它是一个包含模块（通常是 `.jar` 文件，但内部有 `module-info.class`）的列表或目录。JVM 在模块路径上解析模块，而不是盲目地搜索类。
4.  **强封装**
    这是模块系统带来的最大好处。**如果一个模块没有 `exports` 某个包，那么即使这个包里的类是 `public` 的，其他模块也无法编译或访问它们。** 这彻底解决了“内部实现泄露”的问题。
#### 2. 模块系统的关键指令
| 指令 | 用途 | 示例 |
| :--- | :--- | :--- |
| `requires <module>` | 声明对另一个模块的依赖。 | `requires java.base;` |
| `requires transitive <module>` | 传递依赖。任何依赖本模块的模块，都会自动依赖 `<module>`。 | `requires transitive java.sql;` |
| `exports <package>` | 导出一个包，使其对所有其他模块可见。 | `exports java.util;` |
| `exports <package> to <module1>, <module2>` | 限定导出。只对指定的模块可见。 | `exports jdk.internal.misc to java.base;` |
| `opens <package>` | 开放一个包，使其在运行时可以被**所有**模块深度反射。 | `opens java.base;` |
| `opens <package> to <module1>, <module2>` | 限定开放。只允许指定模块进行深度反射。 | `opens com.myapp.entity to hibernate.core;` |
| `uses <service>` | 声明本模块消费一个服务接口。 | `uses java.sql.Driver;` |
| `provides <service> with <impl1>, <impl2>` | 声明本模块提供了一个服务的实现。 | `provides com.myapp.api.Calculator with com.myapp.impl.BasicCalculator;` |
---



