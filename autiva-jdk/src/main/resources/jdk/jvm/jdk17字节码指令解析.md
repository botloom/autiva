
### JVM 字节码指令速查手册 (基于 Java 17 SE 规范)

JVM 是一个基于栈的虚拟机。大部分指令都围绕着从**局部变量表**加载值到**操作数栈**，在栈上进行计算，然后将结果存回局部变量表。

#### 1. 常量操作

将常量从常量池或直接推入操作数栈。

| 指令            | 描述                                              |
|:--------------|:------------------------------------------------|
| `aconst_null` | 推入 `null` 引用。                                   |
| `iconst_m1`   | 推入 `int` 常量 `-1`。                               |
| `iconst_<i>`  | 推入 `int` 常量 `<i>` (范围 0 到 5)。                   |
| `lconst_<l>`  | 推入 `long` 常量 `<l>` (0L 或 1L)。                   |
| `fconst_<f>`  | 推入 `float` 常量 `<f>` (0.0, 1.0, 2.0)。            |
| `dconst_<d>`  | 推入 `double` 常量 `<d>` (0.0, 1.0)。                |
| `bipush`      | 将一个 byte 值 (-128 到 127) 作为 `int` 推入栈。           |
| `sipush`      | 将一个 short 值 (-32768 到 32767) 作为 `int` 推入栈。      |
| `ldc`         | 从常量池推入一个 `int`, `float`, `String` 或 `Class` 引用。 |
| `ldc_w`       | 同上，但使用更宽的常量池索引。                                 |
| `ldc2_w`      | 从常量池推入一个 `long` 或 `double` 值。                   |
---

#### 2. 加载和存储

在局部变量表和操作数栈之间传输数据。

| 指令                                                                          | 描述                                 |
|:----------------------------------------------------------------------------|:-----------------------------------|
| **加载**                                                                      |                                    |
| `iload_<i>`                                                                 | 将局部变量 `<i>` (0-3) 的 `int` 值推入栈。    |
| `lload_<i>`                                                                 | 将局部变量 `<i>` (0-3) 的 `long` 值推入栈。   |
| `fload_<i>`                                                                 | 将局部变量 `<i>` (0-3) 的 `float` 值推入栈。  |
| `dload_<i>`                                                                 | 将局部变量 `<i>` (0-3) 的 `double` 值推入栈。 |
| `aload_<i>`                                                                 | 将局部变量 `<i>` (0-3) 的**引用**值推入栈。     |
| `iload`                                                                     | 将指定索引的局部变量的 `int` 值推入栈。            |
| `lload`, `fload`, `dload`, `aload`                                          | 同上，但用于不同类型。                        |
| `iaload`                                                                    | 从 `int` 数组中加载一个元素。                 |
| `laload`, `faload`, `daload`, `aaload`, `baload`, `caload`, `saload`        | 从相应类型的数组中加载一个元素。                   |
| **存储**                                                                      |                                    |
| `istore_<i>`                                                                | 将栈顶的 `int` 值存入局部变量 `<i>` (0-3)。    |
| `lstore_<i>`                                                                | 将栈顶的 `long` 值存入局部变量 `<i>` (0-3)。   |
| `fstore_<i>`                                                                | 将栈顶的 `float` 值存入局部变量 `<i>` (0-3)。  |
| `dstore_<i>`                                                                | 将栈顶的 `double` 值存入局部变量 `<i>` (0-3)。 |
| `astore_<i>`                                                                | 将栈顶的**引用**值存入局部变量 `<i>` (0-3)。     |
| `istore`                                                                    | 将栈顶的 `int` 值存入指定索引的局部变量。           |
| `lstore`, `fstore`, `dstore`, `astore`                                      | 同上，但用于不同类型。                        |
| `iastore`                                                                   | 将 `int` 值存入 `int` 数组。              |
| `lastore`, `fastore`, `dastore`, `aastore`, `bastore`, `castore`, `sastore` | 将值存入相应类型的数组。                       |
---

#### 3. 操作数栈管理

直接操作操作数栈。

| 指令        | 描述                                               |
|:----------|:-------------------------------------------------|
| `pop`     | 弹出栈顶一个值（非 `long` 或 `double`）。                    |
| `pop2`    | 弹出栈顶一个值（`long` 或 `double`）或两个值。                  |
| `dup`     | 复制栈顶一个值并推入。                                      |
| `dup_x1`  | 复制栈顶值，并插入到栈顶第二个值之下。                              |
| `dup_x2`  | 复制栈顶值，并插入到栈顶第二个或第三个值之下。                          |
| `dup2`    | 复制栈顶一个 (`long`/`double`) 或两个值，并推入。               |
| `dup2_x1` | 复制栈顶一个或两个值，并插入到下方。                               |
| `dup2_x2` | 复制栈顶一个或两个值，并插入到更下方。                              |
| `swap`    | 交换栈顶两个值（必须是 `category 1` 类型，即非 `long`/`double`）。 |
---
#### 4. 数学运算

在操作数栈上进行数值计算。

| 指令       | 描述                                               |
|:---------|:-------------------------------------------------|
| **加法**   | `iadd`, `ladd`, `fadd`, `dadd`                   |
| **减法**   | `isub`, `lsub`, `fsub`, `dsub`                   |
| **乘法**   | `imul`, `lmul`, `fmul`, `dmul`                   |
| **除法**   | `idiv`, `ldiv`, `fdiv`, `ddiv`                   |
| **取余**   | `irem`, `lrem`, `frem`, `drem`                   |
| **取反**   | `ineg`, `lneg`, `fneg`, `dneg`                   |
| **位移**   | `ishl`, `ishr`, `iushr`, `lshl`, `lshr`, `lushr` |
| **按位与**  | `iand`, `land`                                   |
| **按位或**  | `ior`, `lor`                                     |
| **按位异或** | `ixor`, `lxor`                                   |
| **增量**   | `iinc` (直接对局部变量进行 `+n` 操作，不涉及操作数栈)               |
---

#### 5. 类型转换

在操作数栈顶进行类型转换。

| 指令    | 描述                   |
|:------|:---------------------|
| `i2l` | `int` → `long`       |
| `i2f` | `int` → `float`      |
| `i2d` | `int` → `double`     |
| `l2i` | `long` → `int`       |
| `l2f` | `long` → `float`     |
| `l2d` | `long` → `double`    |
| `f2i` | `float` → `int`      |
| `f2l` | `float` → `long`     |
| `f2d` | `float` → `double`   |
| `d2i` | `double` → `int`     |
| `d2l` | `double` → `long`    |
| `d2f` | `double` → `float`   |
| `i2b` | `int` → `byte` (截断)  |
| `i2c` | `int` → `char` (截断)  |
| `i2s` | `int` → `short` (截断) |
---

#### 6. 对象创建与操作

创建、操作和检查对象。

| 指令               | 描述                                   |
|:-----------------|:-------------------------------------|
| `new`            | 创建一个对象实例，但**不调用构造函数**。               |
| `newarray`       | 创建一个基本类型数组。                          |
| `anewarray`      | 创建一个引用类型数组。                          |
| `multianewarray` | 创建一个多维数组。                            |
| `arraylength`    | 获取数组长度。                              |
| `athrow`         | 抛出栈顶的异常对象。                           |
| `checkcast`      | 检查类型转换，如果失败则抛出 `ClassCastException`。 |
| `instanceof`     | 检查对象是否是指定类型的实例，结果 (`int` 0/1) 入栈。    |
| `monitorenter`   | 进入一个对象的监视器锁（即 `synchronized` 块的开始）。  |
| `monitorexit`    | 退出一个对象的监视器锁（即 `synchronized` 块的结束）。  |
---

#### 7. 字段访问

读写对象的字段或静态字段。

| 指令          | 描述                      |
|:------------|:------------------------|
| `getstatic` | 获取一个**静态**字段的值，并推入栈。    |
| `putstatic` | 将栈顶的值存入一个**静态**字段。      |
| `getfield`  | 获取一个对象的**实例**字段的值，并推入栈。 |
| `putfield`  | 将栈顶的值存入一个对象的**实例**字段。   |
---

#### 8. 方法调用

调用实例方法、静态方法或父类方法。

| 指令                | 描述                                                       |
|:------------------|:---------------------------------------------------------|
| `invokevirtual`   | 调用**实例方法**，基于对象的实际类型进行**动态分派**（虚调用）。                     |
| `invokespecial`   | 调用**实例方法**，但**不进行动态分派**。用于：构造函数、`private` 方法、`super` 调用。 |
| `invokestatic`    | 调用**静态方法**。                                              |
| `invokeinterface` | 调用**接口方法**，同样是动态分派。                                      |
| `invokedynamic`   | **动态调用**。运行时第一次执行时才确定要调用的方法。是 Lambda 表达式和其他动态语言的基础。      |
---

#### 9. 控制流

改变指令的执行顺序（`if`, `for`, `switch` 的底层实现）。

| 指令                                                                           | 描述                             |
|:-----------------------------------------------------------------------------|:-------------------------------|
| **条件跳转 (比较 `int`)**                                                          |                                |
| `ifeq`, `ifne`, `iflt`, `ifle`, `ifgt`, `ifge`                               | 比较栈顶 `int` 值与 0，满足条件则跳转。       |
| `if_icmpeq`, `if_icmpne`, `if_icmplt`, `if_icmple`, `if_icmpgt`, `if_icmpge` | 比较栈顶两个 `int` 值，满足条件则跳转。        |
| **条件跳转 (比较引用)**                                                              |                                |
| `if_acmpeq`, `if_acmpne`                                                     | 比较栈顶两个引用，相等或不相等则跳转。            |
| **条件跳转 (null 判断)**                                                           |                                |
| `ifnull`, `ifnonnull`                                                        | 判断栈顶引用是否为 `null`。              |
| **无条件跳转**                                                                    |                                |
| `goto`                                                                       | 无条件跳转到指定位置。                    |
| `jsr`, `ret`                                                                 | 用于 `finally` 子句的古老跳转指令，已基本被废弃。 |
| **表跳转 (`switch` 实现)**                                                        |                                |
| `tableswitch`                                                                | 用于 `switch` 语句，当 case 值连续时效率高。 |
| `lookupswitch`                                                               | 用于 `switch` 语句，当 case 值稀疏时使用。  |
---

#### 10. 返回指令

从方法中返回。

| 指令        | 描述                  |
|:----------|:--------------------|
| `ireturn` | 从方法返回一个 `int` 值。    |
| `lreturn` | 从方法返回一个 `long` 值。   |
| `freturn` | 从方法返回一个 `float` 值。  |
| `dreturn` | 从方法返回一个 `double` 值。 |
| `areturn` | 从方法返回一个**引用**值。     |
| `return`  | 从 `void` 方法返回。      |
---

#### 11. 扩展指令

以 `wide` 前缀开头，用于支持更大的局部变量索引。

| 指令     | 描述                                                                                                                                         |
|:-------|:-------------------------------------------------------------------------------------------------------------------------------------------|
| `wide` | 修改其后的 `iload`, `fload`, `aload`, `lload`, `dload`, `istore`, `fstore`, `astore`, `lstore`, `dstore`, `ret`, `iinc` 指令，使其使用 16 位的索引来访问局部变量。 |
---

#### 12. 调试指令

| 指令           | 描述                    |
|:-------------|:----------------------|
| `breakpoint` | 由调试器使用，在 JVM 实现中是可选的。 |
---
